<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Player</title>
</head>
<body>
  <label for="durationInput">Duration (seconds):</label>
  <button id="playForDurationButton">Play</button>
  <button id="stopButton" disabled>Stop Audio</button>
  <div class="container">
    <div class="dropdown" >
        <select id="myDropdown"  onchange="getValue()">
          <option value="0" selected>Select Therapy</option>
          <option value="1">Brown</option>
          <option value="2">Pink</option>
          <option value="3">Violet</option>
        </select>
    </div>
    <div>
      <select type="number" id="durationInput" onchange="getTime()">
          <option value="0">Select Duration</option>
          <option value="1">1 min</option>
          <option value="15">15 min</option>
          <option value="30">30 min</option>
          <option value="45">45 min</option>
          <option value="60">1hr</option>
          <option value="120">2hr</option>
      </select>
    </div>
  <script>
    duration = 0;
    sound_file = 0;
    function getTime() {
      Time = document.getElementById("durationInput");
      duration = parseInt(Time.value, 10);
  };
    function getValue() {
      // Get the dropdown element
       dropdown = document.getElementById("myDropdown");
      
      // Get the selected value
       selectedValue = dropdown.value;
  
      if (selectedValue == 1){
        sound_file = "Audio/Therapy/2sBrown.mp3";
      }
      else if (selectedValue == 2){
        sound_file = "Audio/Therapy/2sPink.mp3";
      }
      else if (selectedValue == 3){
        sound_file = "Audio/Therapy/2sViolet.mp3";
      };
    }
    let audioCtx;
let source;
let timer;
const playForDurationButton = document.getElementById('playForDurationButton');
const stopButton = document.getElementById('stopButton');
playForDurationButton.addEventListener('click', async () => {
  if (isNaN(duration) || duration <= 0) {
    alert('Please select duration.');
    return;
  };
  if (sound_file <= 0){
    alert('Please select therapy.');
    return;
  };
  try {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    source = audioCtx.createBufferSource();

    const arrayBuffer = await fetch(sound_file).then(res => res.arrayBuffer());
    const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

    source.buffer = audioBuffer;
    source.loop = true;
    source.connect(audioCtx.destination);
    source.start();

    playForDurationButton.disabled = true;
    stopButton.disabled = false;

    timer = setTimeout(() => {
      if (source) {
        source.stop();
        playForDurationButton.disabled = false;
        stopButton.disabled = true;
      }
      clearInterval(timer);
    }, duration * 60000); // Convert mins to milliseconds
  } catch (error) {
    alert ('Error:', error);
    console.error('Error:', error);
  }
});

stopButton.addEventListener('click', () => {
  if (source) {
    source.stop();
    playForDurationButton.disabled = false;
    stopButton.disabled = true;
    clearInterval(timer);
  }
});

  </script>
</body>
</html>
